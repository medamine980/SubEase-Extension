(()=>{const e=document.querySelector("[data-about-us-btn]"),t=document.querySelector("[data-about-us-dialog]"),o=document.querySelector("[data-settings-btn]"),a=document.querySelector("[data-settings-dialog]"),n=document.querySelector("[data-autosync-checkbox]"),d=document.querySelector("[data-radar]");document.querySelector("[data-loading-prog]");chrome.tabs.query({active:!0,currentWindow:!0},(function(e){const t=document.querySelector("[data-videos-list]"),o=chrome.tabs.connect(e[0].id,{name:"subtitles"});let a,n=0;a=setInterval((()=>{if(2===n){if(0===t.childElementCount){const e=document.createElement("li");e.classList.add("videos-list__item-msg"),e.textContent="No videos are found",t.id="not-found-item",t.appendChild(e),t.ariaBusy=!1}return d.remove(),clearInterval(a)}n++,o.postMessage({type:"initial"})}),400);let c=[];o.onMessage.addListener((function(e){if("initial"===e.type){const{id:a,platform:n,videosLength:d,videosTitle:i,activatedVideos:s,icon:r}=e;if(0===d||c.find((({id:e})=>e==e)))return;c.push({id:a,videosLength:d}),document.querySelector("#not-found-item")?.remove();for(let e=0;e<d;e++){const d=document.createElement("li"),c=document.createElement("img");c.src=r??"../images/any-video.png",c.width=32,c.height=32;const l=document.createElement("div"),u=document.createElement("h3");let m;u.textContent=i[e],u.classList.add("videos-list__item__title"),u.title=i[e],s[e]&&(m=document.createElement("span"),m.innerHTML="&#x2713;",m.classList.add("videos-list__item__checkmark"),m.dataset.checkmark=!0);const v=document.createElement("p");v.textContent=`platform: ${n}`,l.append(u,v),d.classList.add("videos-list__item"),d.dataset.video=e,d.dataset.id=a,d.addEventListener("mouseover",(t=>{o.postMessage({type:"videoHover",id:a,videoIndex:e})})),d.addEventListener("mouseout",(t=>{o.postMessage({type:"removeVideoHover",id:a,videoIndex:e})})),d.addEventListener("click",(t=>{if(o.postMessage({type:"videoChosen",id:a,videoIndex:e}),!d.querySelector("[data-checkmark]")){const e=document.createElement("span");e.innerHTML="&#x2713;",e.classList.add("videos-list__item__checkmark"),e.dataset.checkmark=!0,d.append(e)}window.close()})),m&&d.append(m),d.append(c,l),t.appendChild(d)}}}))})),e.addEventListener("click",(e=>{t.showModal(),t.querySelector("a").blur()})),o.addEventListener("click",(e=>{a.showModal()})),window.addEventListener("click",(e=>{e.target===t?t.close():e.target===a&&a.close()})),chrome.storage.local.get(["autoSync"]).then((({autoSync:e})=>{n.checked=e??!0,null==e&&chrome.storage.local.set({autoSync:!0})})),n.addEventListener("change",(async e=>{await chrome.storage.local.set({autoSync:e.currentTarget.checked})}))})();
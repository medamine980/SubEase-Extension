(()=>{const t=document.querySelector(".hoster-player");function e(){const t=location.href.match("https://bs.to/serie/([A-Za-z0-9-]+)/.+");return t?.[1]}function o(){const t=location.href.match("https://bs.to/serie/[A-Za-z0-9-]+/(\\d+)/.+");return t?.[1]}function n(){const t=location.href.match("https://bs.to/serie/[A-Za-z0-9-]+/\\d+/(\\d).+");return t?.[1]}async function r(){const t=e(),r=function(){switch(o()){case"1":return"first";case"2":return"second";case"3":return"third";case"4":return"forth";case"5":return"fifth";case"6":return"sixth";case"7":return"seventh";case"8":return"eighth";case"9":return"nineth";case"10":return"tenth"}}(),c=n();let s="https://subscene.com/subtitles/searchbytitle/",a=encodeURI(s);const l=encodeURIComponent(JSON.stringify({query:`${t} ${r} season`}));let i=await fetch(`http://localhost/api/download?url=${a}&method=POST&body=${l}`);const h=new DOMParser;page=h.parseFromString(await i.text(),"text/html");const u=page.querySelectorAll("div.title a");if(0===u.length)return console.warn("SUBTITLES NOT FOUND"),null;const p=u[0].href.replace("bs.to","subscene.com");console.log(p),s=p,a=encodeURI(s),i=await fetch(`http://localhost/api/download?url=${a}`),page=h.parseFromString(await i.text(),"text/html");const d=page.querySelectorAll(".positive-icon ~ span");let m=[];console.log(page);for(let t=0;t<d.length;t++){const e=d[t];e.innerText.trim().match(`.+[Ee]0?${c}.+`)&&e.parentElement.firstElementChild.innerText.trim().match(/English/i)&&(m.push(e.parentElement.href.replace("bs.to","subscene.com")),console.log("pushed"))}0!==m.length?(s=m[0],a=encodeURI(s),i=await fetch(`http://localhost/api/download?url=${a}`),page=h.parseFromString(await i.text(),"text/html"),s=page.querySelector("#downloadButton").href.replace("bs.to","subscene.com"),i=await fetch(`http://localhost/api/download?url=${a}`),console.log(await i.text())):console.log(d)}const c=document.querySelector(".hoster-tabs li.active a").textContent.trim().toLocaleLowerCase(),s="vidoza";let a;async function l(){const t=e(),l=o(),i=n();if(c===s){const e=document.querySelector("iframe[src^='https://vidoza.net']").src,o=encodeURI(e);console.log("fetching...");const n=await fetch(`http://localhost/api/download?url=${o}&resType=text`,{method:"GET"}),c=await n.text(),s=(new DOMParser).parseFromString(c,"text/html").querySelector("#player source").src;console.log(s),console.log(t,l,i),r()}clearInterval(a)}t.addEventListener("click",(t=>{a=setInterval(l,1e4)}))})();
(()=>{"use strict";class e{static port;constructor(t,a,s){e.port||("to-tab"===a?e.port=chrome.tabs.connect(s.id,{name:t}):"to-background"===a&&(e.port=chrome.runtime.connect({name:t})))}postMessage(t){e.port.postMessage(t)}addMessageListener(t){e.port.onMessage.addListener(t)}}const t=document.querySelector("[data-select-subtitle-btn]"),a=document.querySelector("[data-sync-range]"),s=document.querySelector("[data-sync-number]"),o=document.querySelector("[data-settings-form]"),r=document.querySelector("[data-enable-subtitles]"),n=document.querySelector("[data-bg-color]"),c=document.querySelector("[data-text-color]"),d=decodeURIComponent(location.search).split("&"),l=d[0].match(/=(.+)/)[1],u=d[1].match(/=(.+)/)[1];let i=d[2].match(/=(.+)/)[1];d[3].match(/=(.+)/)[1];const m="textColor",g="bgColor";let b,h,v,y;"true"===i&&(r.disabled=!1,r.checked=!0),window.addEventListener("message",(e=>{"trackAdded"===e.data.type&&(r.disabled=!1,r.checked=!0)})),chrome.storage.local.get([m,g]).then((e=>{e[m]&&(c.value=e[m]),e[g]&&(n.value=e[g])})),o.onsubmit=e=>!1,c.addEventListener("change",(()=>{clearTimeout(h),h=setTimeout((()=>{chrome.tabs.getCurrent((t=>{new e("settingsIframe","to-tab",t).postMessage({id:l,videoIndex:u,type:"changeTextColor",color:c.value}),chrome.storage.local.set({[m]:c.value})}))}),250)})),n.addEventListener("change",(()=>{clearTimeout(v),v=setTimeout((()=>{chrome.tabs.getCurrent((t=>{new e("settingsIframe","to-tab",t).postMessage({id:l,videoIndex:u,type:"changeBgColor",color:n.value}),chrome.storage.local.set({[g]:n.value})}))}),250)})),r.addEventListener("change",(()=>{clearTimeout(y),y=setTimeout((()=>{chrome.tabs.getCurrent((t=>{new e("settingsIframe","to-tab",t).postMessage({id:l,videoIndex:u,type:"enableSubtitles",enable:r.checked})}))}),250)})),s.addEventListener("change",(async t=>{a.value=s.valueAsNumber,clearTimeout(b),b=setTimeout((()=>{chrome.tabs.getCurrent((t=>{new e("settingsIframe","to-tab",t).postMessage({id:l,videoIndex:u,type:"syncSubtitles",syncValue:s.valueAsNumber})}))}),1e3)})),a.addEventListener("change",(async t=>{s.value=a.valueAsNumber,clearTimeout(b),b=setTimeout((()=>{chrome.tabs.getCurrent((t=>{new e("settingsIframe","to-tab",t).postMessage({id:l,videoIndex:u,type:"syncSubtitles",syncValue:a.valueAsNumber})}))}),1e3)})),t.addEventListener("click",(()=>{chrome.tabs.getCurrent((t=>{new e("settingsIframe","to-tab",t).postMessage({id:l,videoIndex:u,type:"selectSubtitles"})}))})),chrome.storage.local.get(["syncValue"],(e=>{a.value=e.syncValue??0,s.value=e.syncValue??0}))})();